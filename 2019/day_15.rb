$oxygen = []

$grid = Array.new(41).map do
  Array.new(41)
end

DATA.readlines.each.with_index do |row, y|
  row.chars.each_with_index do |char, x|
    $oxygen << [x,y] if char == 'Z'
    $grid[y][x] = char
  end
end

def show
  puts "Time passed: #{$tick} minute(s)"
  puts $grid.map(&:join)
end

$tick = 0
def tick
  if $oxygen.empty?
    puts "No more empty fields after #{$tick} minutes"
    return
  end

  $tick += 1
  $oxygen = $oxygen.map do |field|
   x, y = *field
   new_fields = [
    [x - 1, y],
    [x + 1, y],
    [x, y - 1],
    [x, y + 1]
   ]
   new_fields.reject do |fld|
     next true if fld[0].negative?
     next true if fld[1].negative?

     if $grid[fld[1]][fld[0]] == ' '
       $grid[fld[1]][fld[0]] = 'Z'
       next false
     end
     true
   end
 end.flatten(1).uniq
end

binding.irb

__END__
#########################################
#       #             #             #   #
# ##### # # # ####### # # ######### ### #
#Z#     # # # #     # # # #       #   # #
### ### # # ### ### ### # # ### ##### # #
#   #   # #   # # #     # # # #       # #
# ####### ### # # ####### # # ######### #
# #       # # #   #     # # #   #       #
# # ####### # ### # ### # # # # ##### # #
# #         #     #   #   #   #     # # #
# # ####### ######### ############# ### #
#   #   # # #       # #   #       #   # #
##### # # # # ### ### # ### ### ##### # #
#     # #     #   #   #       #     #   #
# ##### ########### ### ####### # ##### #
# #   #       #   #   # #     # #     # #
# ### ####### # # # # ### ### ##### ### #
#           #   # # #     #   #     #   #
########### ##### # ####### ### ##### ###
#     # #   #   # #   #     # #     # # #
# ### # # ##### # ##### ##### # ### # # #
# #     #       # #  S#     #   # #   # #
# ##### ####### # # ### ### # ### ##### #
#   #   #     # #   #   #   #   #   #   #
# # # ### ### # ######### ##### ### # # #
# # # #   #   # #     #   #   #   #   # #
# # # ##### ### ### # # ### # ### ### # #
# # #     # #   #   #   #   #   #   # # #
# # ##### # # ### ####### ##### ### ### #
# # #   # # # #   # #       #     #   # #
# # # ### # # ### # # ####### ### ### # #
# # #     # #     #       #   #     # # #
### # ##### ########### ### ### ##### # #
#   # #     #         # #   # #   #   # #
# ### # ### # ####### ### ### # ### ### #
# #     #     #   #       #   # #   #   #
# # ######### # # ##### ##### # # ### # #
# # #   #   # # #     # #   #   #     # #
# ### # # # ### ##### ### # ########### #
#     #   #         #     #             #
#########################################
